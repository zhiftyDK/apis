<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="ztermicon.png" type="image/png" sizes="32x32">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <title>ZTerm</title>
    <style>
        *{
            margin: 2px;
            padding: 2px;
            background-color: black;
            color: white;
            overflow: hidden;
        }

        #terminalPrefix{
            display: inline;
            margin-right: 0px;
        }

        #terminalInput{
            border-style: none;
            display: inline;
            margin-bottom: 10px;
            margin-top: 20px;
            margin-left: 0px;
        }

        #terminalInput:focus{
            outline: none;
        }
    </style>
</head>
<body>
    <div id="terminal">
        <p id="terminalText"></p>

        <p id="terminalPrefix">$</p>
        <input type="text" id="terminalInput" autocomplete="off">
    </div>

    <img id="junkOne" style="display: none;"/>
    <p id="timer" style="display: none;"></p>
    <script>
        //Variables
        const terminal = document.getElementById("terminal");
        const terminalText = document.getElementById("terminalText");
        const terminalPrefix = document.getElementById("terminalPrefix");
        const terminalInput = document.getElementById("terminalInput");
        const terminalDatabase = [];
        const scrollingElement = (document.scrollingElement || document.body)

        //Load Terminal
        function loadTerminal() {
            terminalDatabase.push("Zhifty Terminal");
            terminalDatabase.push("The first client side terminal ever!");
            terminalDatabase.push("");
            const formatTerminalDatabase = terminalDatabase + "";
            const formattedTerminalDatabase = formatTerminalDatabase.split(",").join("<br>");
            terminalText.innerHTML = formattedTerminalDatabase;
        }
        window.onload = loadTerminal;

        //Focus Terminal
        setInterval(() => {
            terminalInput.focus();
        });

        //Terminal Handler
        terminalInput.addEventListener("keyup", function(event) {
            if (event.keyCode === 13 && terminalInput.value !== "") {
                event.preventDefault();

                //Terminal Commands
                if(terminalInput.value == "--version") { //shows version information
                    terminalDatabase.push("$ " + terminalInput.value);
                    terminalDatabase.push("You are running Zhifty Terminal version 0.1");
                    terminalDatabase.push("");
                    pushCommand();
                } 
                else if(terminalInput.value == "--clear") { //clears the terminal
                    location.reload();
                }
                else if(terminalInput.value.includes("--start")) { //starts any website
                    terminalDatabase.push("$ " + terminalInput.value);
                    const startLink = "http://" + terminalInput.value.replace(/--start /g, "") 
                    terminalDatabase.push("You started " + startLink);
                    terminalDatabase.push("");
                    window.open(startLink, "_blank");
                    pushCommand();
                }
                else if(terminalInput.value.includes("--ping")) { //pings any website
                    terminalDatabase.push("$ " + terminalInput.value);
                    const pingLink = terminalInput.value.replace(/--ping /g, "")
                    terminalDatabase.push("Pinging http://" + pingLink + "...");
                    terminalDatabase.push("");

                    $.ajaxSetup({ cache: false });
                    $( document ).ready(function() {
                        var start = new Date().getTime();
                        $('#junkOne').on('error', function (e) {
                            var end = new Date().getTime();
                            $("#timer").html("" + (end-start) + "ms");
                            setTimeout(() => {
                                terminalDatabase.push(document.getElementById("timer").innerHTML)
                                pushCommand();
                                terminalPrefix.style.display = "inline";
                                terminalInput.style.display = "inline";
                            }, end-start+1000);
                        }).attr('src', 'http://' + pingLink + '/latency.jpg?d=' + new Date().getTime());
                    });
                    terminalPrefix.style.display = "none";
                    terminalInput.style.display = "none";
                    pushCommand();
                }
                else if(terminalInput.value.includes("--lookup")) { //get location of ip adress
                    terminalDatabase.push("$ " + terminalInput.value);
                    const iplookup = terminalInput.value.replace(/--lookup /g, "")
                    terminalDatabase.push("Looking up " + iplookup + "...");
                    terminalDatabase.push("");
                    setTimeout(() => {
                        window.open("https://www.ip-tracker.org/locator/ip-lookup.php?ip=" + iplookup);
                    }, 2000);
                    pushCommand();
                }
                else if(terminalInput.value.includes("--color")) { //change text color
                    terminalDatabase.push("$ " + terminalInput.value);
                    const colorType = terminalInput.value.replace(/--color /g, "")
                    terminalDatabase.push("Changed color to " + colorType + "...");
                    terminalDatabase.push("");
                    terminalPrefix.style.color = colorType;
                    terminalInput.style.color = colorType;
                    terminalText.style.color = colorType;
                    pushCommand();
                }
                else {
                    pushNoncommand();
                }

                //Terminal DB Push
                function pushCommand() {
                    const formatTerminalDatabase = terminalDatabase + "";
                    const formattedTerminalDatabase = formatTerminalDatabase.split(",").join("<br>");
                    terminalText.innerHTML = formattedTerminalDatabase;
                }

                function pushNoncommand() {
                    terminalDatabase.push("$ " + terminalInput.value);
                    const formatTerminalDatabase = terminalDatabase + "";
                    const formattedTerminalDatabase = formatTerminalDatabase.split(",").join("<br>");
                    terminalText.innerHTML = formattedTerminalDatabase;
                }

                terminalInput.value = "";
                scrollingElement.scrollTop = scrollingElement.scrollHeight;
            }
        });

    </script>
</body>
</html>
